function LoadCustomInstance(url:string,Name:string)
    if not isfile(Name..".rbxm") then
        writefile(Name..".rbxm", game:HttpGet(url))
    end

    return game:GetObjects(getcustomasset(Name..".rbxm",true))[1]
end

function MoveTo(cframe,speed,model)
	local reached = false
	local connection; connection = game:GetService("RunService").Stepped:Connect(function(_, step)
        local pivot = model:GetPivot()
        local difference = (cframe.Position - pivot.Position)
        local unit = difference.Unit
        local magnitude = difference.Magnitude

        if magnitude > 0.1 then
            model:PivotTo(pivot + unit * math.min(step * speed, magnitude))
        else
            connection:Disconnect()
            reached = true
        end

	repeat game:GetService("RunService").Stepped:Wait() until reached
end

local Rooms = game.Workspace.CurrentRooms

local ManiacAmbushModel = LoadCustomInstance("https://github.com/Jahani-john/mayhem-mode/raw/refs/heads/main/mayhemmode-main/NMAmbush.rbxm","Maniac_ambush")
ManiacAmbushModel.Parent = game.Workspace

local Ambush = ManiacAmbushModel.AmbushNew

local s = Instance.new("Sound",game.Workspace)
s.SoundId = "rbxassetid://134020218579308"
s.PlaybackSpeed = 0.8
s:Play()

s.Played:wait()

Ambush.CFrame = Rooms:GetChildren()[1].RoomEntrance.CFrame

for i = 1 , 6 do
	for _ = 0 , #Rooms:GetChildren() , 1 do
		if Room.Parent then
			local WayPoints = Room:FindFirstChild("PathFindNodes")
			if WayPoints then
				for _ , Point in WayPoints:GetChildren() do
                    MoveTo(Point.CFrame,170,Ambush)
                end
            end
            if Room:FindFirstChild("RoomExit") then
                MoveTo(Room.RoomExit.CFrame,170,Ambush)
            end
        end
    end
	for _ = #Rooms:GetChildren() , 0 , -1 do
		if Room.Parent then
			local WayPoints = Room:FindFirstChild("PathFindNodes")
			if WayPoints then
                table.sort(WayPoints, function(a, b) return tonumber(a.Name) > tonumber(b.Name) end)
				for _ , Point in WayPoints:GetChildren() do
                    MoveTo(Point.CFrame,170,Ambush)
                end
            end
            if Room:FindFirstChild("RoomExit") then
                MoveTo(Room.RoomExit.CFrame,170,Ambush)
            end
        end
    end
    task.wait(2)
end
